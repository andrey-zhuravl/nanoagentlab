# Vision (5 шагов развития)

## Цель
Построить мульти‑агентную систему с оркестратором в центре, способную решать задачи:
- работа на удалённых серверах; написание и ревью кода; тестирование;
- интеграции с СХД: SQL/NoSQL, Kafka, S3/объектные хранилища, очереди сообщений, Redis и пр.;
- использование MCP‑интерфейса, RAG‑хранилищ и LangChain;
- расширяемость за счёт конфигурируемых ролей агентов.

Принципы: инкрементальная разработка, строгий TDD, полная автоматизация интеграционных проверок и воспроизводимость через Docker.

---

## Шаг 1. Тестовый сервер + интеграционные тесты (TDD-скелет)
**Что добавляем**
- Новый модуль `test-server/` — минимальный FastAPI‑сервис, запускающий интеграционные сценарии.
- Набор тестов, каждый из которых:
  1) отправляет запрос(ы) в **оркестратор**;  
  2) ждёт ответы/события;  
  3) проверяет контракты (статусы, схемы, тайминги, идемпотентность).

**Технические артефакты**
- `test-server/main.py` (FastAPI + маршруты `/run/{case}` и `/health`).  
- Набор кейсов в `test-server/cases/`: YAML/JSON с шагами (Arrange‑Act‑Assert).  
- GitHub Actions/Make‑таргеты для локального и CI‑прогонов.

**Критерии готовности**
- Один «сквозной» тест: оркестратор → агент → ответ.  
- Запуск тестов одной командой: `make itest` или `docker compose up --build` + `curl /run/smoke`.

---

## Шаг 2. Разделение окружений и compose‑стеков
**Что делаем**
- Два компоуз‑файла: `docker-compose.test.yml` и `docker-compose.prod.yml` (+ общий `docker-compose.yml`).  
- Отдельные профили/переменные окружения для теста и продакшна (volumes, сети, лимиты).  
- Логи и метрики: единые форматы, ротация, минимальный трейсинг запросов.

**Критерии готовности**
- Один набор тестов успешно идёт в тестовом стеке.  
- Прод‑стек поднимается и проходит smoke‑проверку живости/готовности.

---

## Шаг 3. План функциональности (без LLM, через mocks)
**Подход**
- LLM не подключаем; вместо них — **mocks** слоёв «планировщик», «исполнитель», «доступ к СХД».  
- Сосредотачиваемся на протоколах взаимодействия, ошибках, ретраях, маршрутизации.

**Последовательность разработки**
1. **Контракты Orchestrator ↔ Agent**: REST/WebSocket, схемы запросов/ответов, корреляция, statemachine задач.  
2. **Планировщик задач в оркестраторе**: очереди, приоритеты, дедлайны, ретраи, идемпотентность.  
3. **Работа с СХД (через mocks):** абстракции клиентов SQL/NoSQL/Kafka/S3/Redis; единый интерфейс доступа; конфиги.  
4. **MCP‑интерфейс (заглушки):** договорённости по командам/инструментам, сериализация, контроль прав (ACL).  
5. **RAG‑интерфейсы (mock):** единый клиент до вектор‑хранилища/индекса, контекстный injection, кэширование.  
6. **Набор интеграционных тестов** на каждую из подсистем, включая деградационные сценарии.

**Критерии готовности**
- Все протоколы стабилизированы, тесты зелёные без реальных LLM и внешних СХД.

---

## Шаг 4. Подключение реальных интеграций (минимальный набор)
- Включить **LangChain** и базовые LLM‑инструменты (локальные/облачные провайдеры через конфиг).  
- Поднять реальные клиенты к выбранному **SQL** и **Redis** (или KV) для простых задач.  
- Подключить **MCP** к 1–2 инструментам (например, файловая система и shell с белым списком команд).  
- Ввести RAG‑хранилище (локальный FAISS/Chroma) и простой конвейер индексации/извлечения.

**Критерии готовности**
- Сквозной кейс «написание кода → запуск теста → сохранение артефакта → отчёт» проходит end‑to‑end.  

---

## Шаг 5. Расширение возможностей и прод‑уровень
- Добавить интеграции: **Kafka**, **S3/объектное хранилище**, **NoSQL** (Mongo/Cassandra), очереди сообщений.  
- Расширить MCP‑набор инструментов, добавить контроль ресурсов и квот.  
- Улучшить планировщик (батчи, зависимые задачи, DAG‑выполнение).  
- Ввести авторизацию/аудит, трейсинг (OpenTelemetry), фичи надёжности (circuit‑breaker, rate‑limit).  
- Подготовить Helm‑чарты/Compose‑override для staging/prod, секреты, резервные копии.

**Критерии готовности**
- Набор производственных сценариев прогоняется в CI/CD; метрики SLO/алерты; документация и run‑books.

---

## Итог
Путём TDD и поэтапного включения реальных интеграций система эволюционирует от макетов протоколов к продукционному мульти‑агентному стеку с оркестратором, MCP, RAG и поддержкой ключевых СХД.
